#!/usr/bin/env lua
local config = dofile("config.lua")
--local config = dofile("/etc/handonbot.lua")
--local users = require("database").new_db(config.user_db)
local api = require("telegram-bot-lua.core").configure(config.token)
local proc = require("process")


function api.on_message(message)
    if message.text
    and message.text:match("/r") then
        local data = message.text:match("/r%s*(.+)")
        local state, rets, out = proc.run(data)
        if state then
            api.send_message(message.chat.id,
                ("%s\n\n*Returns:* ```%s````"):format(out, s.ser(rets, true)),
                "Markdown", true, true, message.id)
        else
            api.send_message(message.chat.id,
                ("*Error:* \n```%s````"):format(rets),
                "Markdown", true, true, message.id)
        end
    end
end

api.run()
